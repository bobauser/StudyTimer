<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">
  <div id="list-mode" class="mode">
    
    <div id="timer-settings">
      <h3 class="custom-title">New Timer Settings</h3>
      <label for="timer-name">Name: </label>
      <input type="text" id="timer-name" placeholder="Type name here">
      <label for="timer-duration">Duration (minutes): </label>
      <input type="number" id="timer-duration" min="1" placeholder="Write minutes here">
      <button id="add-timer-btn">Add Timer</button>
    </div>

    <div>
      <button id="new-timer-btn">New Timer +</button>
      <button id="start-timer-mode-btn">Start timer mode</button>
    </div>
    <div id="timers-list">
      List of timers: empty
    </div>

    <div id="templates-box">
      <h3 class="custom-title">Templates:</h3>
      <div id="templates-list">
        <div class="template-btn" data-template="study45">Study 45</div>
        <div class="template-btn" data-template="break15">Break 15</div>
        <div class="template-btn" data-template="studybreak">Study-Break</div>
        <div class="template-btn" data-template="studybreakx2">Study-Break x2</div>
      </div>

      <button id="clear-timers-btn" class="danger-btn">Clear Timers</button>
    </div>

  </div>
  <div id="timer-mode" class="mode">
    <div id="current-timer">
      <span id="timer-countdown">00:00:00</span>
      <button id="stop-timer-btn">Stop timer</button>
      <button id="restart-timer-btn">Restart Timer</button>
      <button id="cancel-timer-mode-btn">Cancel</button>
    </div>
    <div id="next-timer">
      <h3>Coming up</h3>
      <!-- <span id="next-timer-name"></span> -->
      <span id="next-timer-countdown">00:00:00</span>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const listMode = document.getElementById('list-mode');
    const timerMode = document.getElementById('timer-mode');
    const newTimerBtn = document.getElementById('new-timer-btn');
    const startTimerModeBtn = document.getElementById('start-timer-mode-btn');
    const addTimerBtn = document.getElementById('add-timer-btn');
    const stopTimerBtn = document.getElementById('stop-timer-btn');
    const restartTimerBtn = document.getElementById('restart-timer-btn');
    const cancelTimerModeBtn = document.getElementById('cancel-timer-mode-btn');
    const timersList = document.getElementById('timers-list');
    const timerNameInput = document.getElementById('timer-name');
    const timerDurationInput = document.getElementById('timer-duration');
    const timerCountdown = document.getElementById('timer-countdown');
    const nextTimerCountdown = document.getElementById('next-timer-countdown');

    // Templates
    const templateButtons = document.querySelectorAll('.template-btn');
    const clearTimersBtn = document.getElementById('clear-timers-btn');

    templateButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.template;

        // Clear existing timers first
        timers = [];

        if (type === "study45") {
          timers.push({ name: "Study", duration: 45 * 60 });
        }
        if (type === "break15") {
          timers.push({ name: "Break", duration: 15 * 60 });
        }
        if (type === "studybreak") {
          timers.push({ name: "Study", duration: 45 * 60 });
          timers.push({ name: "Break", duration: 15 * 60 });
        }
        if (type === "studybreakx2") {
          timers.push({ name: "Study 1", duration: 45 * 60 });
          timers.push({ name: "Break 1", duration: 15 * 60 });
          timers.push({ name: "Study 2", duration: 45 * 60 });
          timers.push({ name: "Break 2", duration: 15 * 60 });
        }

        renderTimersList();
      });
    });

    ///button to clear the timers list:
    clearTimersBtn.addEventListener('click', () => {
      timers = [];      // remove all timers in memory
      renderTimersList(); // remove visually
    });



    let timers = [];
    let currentTimerIndex = 0;
    let timerInterval;
    // let audio = new Audio('alert.mp3');
    let audio = new Audio('bassAlert.mp3');

    newTimerBtn.addEventListener('click', () => {
      timerNameInput.value = '';
      timerDurationInput.value = '';
    });

    addTimerBtn.addEventListener('click', () => {
      const name = timerNameInput.value;
      const duration = parseInt(timerDurationInput.value, 10) * 60;

      if (name && duration) {
        timers.push({ name, duration });
        renderTimersList();
      }
    });

    startTimerModeBtn.addEventListener('click', () => {
      if (timers.length > 0) {
        listMode.style.display = 'none';
        timerMode.style.display = 'flex';
        startTimer(currentTimerIndex);
      }
    });

    stopTimerBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      audio.pause();
      currentTimerIndex++;
      if (currentTimerIndex < timers.length) {
        startTimer(currentTimerIndex);
      } else {
        timerMode.style.display = 'none';
        listMode.style.display = 'flex';
      }
    });

    restartTimerBtn.addEventListener('click', () => {
      startTimer(currentTimerIndex);
    });

    cancelTimerModeBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      audio.pause();
      timerMode.style.display = 'none';
      listMode.style.display = 'flex';
      currentTimerIndex = 0;
    });

    function renderTimersList() {
      timersList.innerHTML = '';
      if (timers.length < 1) {
        const emptythinh = document.createElement('span');
        emptythinh.innerText = "List of timers: empty"
        timersList.appendChild(emptythinh)
      } else {
        timers.forEach((timer) => {
          const timerElement = document.createElement('div');
          timerElement.className = 'timer';
          timerElement.innerHTML = `<span>${timer.name}</span><span>${Math.floor(timer.duration / 60)} min</span>`;
          timersList.appendChild(timerElement);
        });
      }
    }

    function startTimer(index) {
      const timer = timers[index];
      let remainingTime = timer.duration;

      clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        remainingTime--;
        updateCountdown(timerCountdown, remainingTime);

        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          audio.loop = true;
          audio.play();
        }
      }, 1000);

      if (timers[index + 1]) {
        updateCountdown(nextTimerCountdown, timers[index + 1].duration);
      } else {
        nextTimerCountdown.textContent = '00:00:00';
      }
    }

    function updateCountdown(element, time) {
      const minutes = Math.floor(time / 60);
      const seconds = time % 60;
      element.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
  });
</script>
</body>
</html>
